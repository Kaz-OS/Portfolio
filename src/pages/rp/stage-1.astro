---
import { getEntry, render } from "astro:content";
import Layout from "../../layouts/Layout.astro";

let Content: any = null;
let title = "Stage 1 — Réalisations";
let skills: string[] = [];
try {
  const entry = await getEntry("rp", "stage-1");
  if (entry) {
    title = entry.data.title;
    const rendered = await render(entry);
    Content = rendered.Content;
    skills = entry.data.skills ?? [];
  }
} catch (e) {
  // no content yet
}
---

<Layout>
  <section class="stage">
    <h1>{title}</h1>
    {
      skills.length > 0 && (
        <ul class="skills">
          {skills.map((s) => (
            <li>{s}</li>
          ))}
        </ul>
      )
    }
    {
      Content ? (
        <article class="content">
          <Content />
        </article>
      ) : (
        <p class="intro">Le contenu du Stage 1 n'est pas encore disponible.</p>
      )
    }

    <div class="links">
      <a class="btn" href="/rp">← Retour aux réalisations</a>
      <a class="btn outline" href="/attestations/ERA_Attestation.pdf" target="_blank" rel="noopener">Voir l'attestation (PDF)</a>
    </div>
  </section>
</Layout>

<style>
  .stage {
    max-width: 980px;
    margin: 2rem auto 4rem;
    padding: 0 1rem;
  }
  h1 {
    margin: 0 0 0.75rem;
    font-size: clamp(1.4rem, 2vw, 2rem);
  }
  .skills {
    display: flex;
    gap: 0.4rem;
    flex-wrap: wrap;
    margin: 0 0 1rem;
    padding: 0;
    list-style: none;
  }
  .skills li {
    font-size: 0.72rem;
    background: #f3f4f6;
    color: #374151;
    border: 1px solid #e5e7eb;
    padding: 0.2rem 0.5rem;
    border-radius: 999px;
  }
  .intro {
    opacity: 0.9;
    margin: 0 0 1.4rem;
  }
  .content {
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 1rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
  }
  .content :global(h1) {
    font-size: 1.4rem;
    margin-top: 1rem;
  }
  .content :global(h2) {
    font-size: 1.2rem;
    margin: 1rem 0 0.5rem;
    padding-left: 0.5rem;
    border-left: 3px solid #111827;
  }
  .content :global(h3) {
    font-size: 1.05rem;
    margin: 0.75rem 0 0.35rem;
  }
  .content :global(p) {
    line-height: 1.65;
  }
  .content :global(ul) {
    margin: 0.25rem 0 0.75rem;
    padding-left: 0;
    list-style: none;
  }
  .content :global(li) {
    position: relative;
    padding-left: 1rem;
    margin: 0.25rem 0;
  }
  .content :global(li)::before {
    content: "";
    position: absolute;
    left: 0;
    top: 0.55em;
    width: 6px;
    height: 6px;
    background: #111827;
    border-radius: 50%;
  }
  .content :global(code) {
    background: #f3f4f6;
    padding: 0.1rem 0.3rem;
    border-radius: 4px;
    font-size: 0.92em;
  }
  .content :global(pre) {
    background: #0b1220;
    color: #e5e7eb;
    padding: 0.8rem;
    border-radius: 8px;
    overflow: auto;
  }
  .content :global(blockquote) {
    margin: 0.5rem 0;
    padding: 0.6rem 0.8rem;
    background: #f9fafb;
    border-left: 3px solid #d1d5db;
    border-radius: 6px;
  }
  .content :global(a) {
    color: #1f2937;
    text-decoration: underline;
    text-underline-offset: 2px;
  }
  .links {
    margin-top: 1.6rem;
    display: flex;
    gap: 0.6rem;
    flex-wrap: wrap;
  }
  .btn {
    display: inline-block;
    background: #111827;
    color: #fff;
    text-decoration: none;
    padding: 0.45rem 0.75rem;
    border-radius: 8px;
    font-size: 0.85rem;
  }
  .btn:hover {
    background: #0b1220;
  }
  .btn.outline {
    background: transparent;
    color: #111827;
    border: 1px solid #e5e7eb;
  }
  .btn.outline:hover {
    background: #f3f4f6;
  }
</style>
